!EvalModel
parameters: [b_xx, b_yy, b_zz, b_xy, b_yz, b_xz, ShapeNucleation]
model: !Switch
  [b_xx, b_yy, b_zz, b_xy, b_yz, b_xz]: !EvalModel
    parameters: [S, sig_zz]
    model: !FunctionMap
      map: 
        sig_zz: |
          return -2670.0*(1.0-0.37)*9.8*29000; 
        S: |
          R = 4.0;								
          return (1.0/R-1.0);
    components: !AndersonianStress
      constants:
        mu_d:      0.1
        mu_s:      0.6
        SH_max:   132.0
        cohesion:  0.0
        s2ratio:   0.5
        S_v: 1
  [ShapeNucleation]: !FunctionMap
            map:
              ShapeNucleation: |
                xc = -3446.35;
                yc= 5.21499;
                zc=-29000;
                r_crit = 1100.0;
                r = sqrt(pow(x-xc, 2.0) + pow(y-yc, 2.0) + pow(z-zc, 2.0));
                if (r < r_crit) {
                  return exp(pow(r,2.0)/(pow(r,2.0)-pow(r_crit,2.0)));
                }
                return 0.0;
components: !FunctionMap
  map:
    nuc_xx:     return ShapeNucleation*b_xx;
    nuc_yy:     return ShapeNucleation*b_yy;
    nuc_zz:     return ShapeNucleation*b_zz;
    nuc_xy:     return ShapeNucleation*b_xy;
    nuc_yz:     return ShapeNucleation*b_yz;
    nuc_xz:     return ShapeNucleation*b_xz;
